---
title: "R Notebook"
output: html_notebook
---

EFFORT IS >180 MINUTES IN THE FOLLOWING OCCASIONS. THESE NEED TO BE EXAMINED FOR THE CAUSE OF THIS PROBLEM - PROBABLY IN THE EFFORT COMPUTING FUNCTION. 2022-07-28 

         Date Shift Week Seq.idx Sea_State Vis Effort Mother_Calf Year    n.hat cumsum.nhat DOY Year.f
1  1994-04-02     1    3     129         4   6    240           0 1994 0.000000   2.0000000  91   1994
2  1994-04-06     1    3     161         3   6    273           0 1994 0.000000   3.6222222  95   1994
3  1994-05-14     1    9     465         3   6    285           0 1994 0.000000 241.6444444 133   1994
4  1995-03-21     4    1      28         3   4    240           0 1995 0.000000   0.0000000  79   1995
5  1995-04-18     1    5     249         7   6    284           1 1995 1.577778  81.4055556 107   1995
6  1995-04-24     4    6     300         5   5    330           4 1995 7.333333 127.6277778 113   1995
7  1995-05-10     1    8     425         2   6    212           0 1995 0.000000 181.6500000 129   1995
8  1996-04-22     1   14     777         3   5    205           1 1996 1.138889 102.6722222 112   1996
9  1996-05-14     2   18     954         3   6    360           1 1996 2.000000 400.2166667 134   1996
10 1996-05-14     4   18     956         5   6    185           0 1996 0.000000 400.2166667 134   1996
11 1996-05-16     1   18     969         5   5    260           0 1996 0.000000 400.2166667 136   1996
12 1996-05-28     4   20    1068         4   5    360           0 1996 0.000000 402.2166667 148   1996
13 1997-04-19     2    6     322         6   2    193           2 1997 2.144444  45.8000000 108   1997
14 1998-03-27     1    1      33         4   4    315           0 1998 0.000000   2.3500000  85   1998
15 1998-03-31     3    2      67         4   4    200           1 1998 1.111111   4.0888889  89   1998
16 1998-04-03     4    2      92         4   4    250           2 1998 2.777778  12.3722222  92   1998
17 1999-06-02     1   11     577         4   4    270           1 1999 1.500000  98.3333333 152   1999
18 2001-04-20     1    5     257         3   4    300           0 2001 0.000000   7.0277778 109   2001
19 2001-04-20     4    5     260         4   5    215           0 2001 0.000000   7.0277778 109   2001
20 2002-04-09     1    4     177         3   3    236           1 2002 1.311111   5.3111111  98   2002
21 2003-03-22     2    1      42         5   4    290           0 2003 0.000000   0.0000000  80   2003
22 2003-03-28     4    2      92         2   3    207           0 2003 0.000000   0.9166667  86   2003
23 2003-04-02     1    3     129         0   2    200           0 2003 0.000000   4.7500000  91   2003
24 2003-04-12     1    4     209         4   4    252           0 2003 0.000000  33.6222222 101   2003
25 2003-04-22     1    6     289         3   4    240           0 2003 0.000000 103.2722222 111   2003
26 2003-05-03     1    7     377         5   5    276           2 2003 3.066667 177.8388889 122   2003
27 2003-05-24     1   10     545         5   2    224           0 2003 0.000000 203.9444444 143   2003
28 2005-04-22     1    5     257         6   4    247           1 2005 1.372222  92.9833333 111   2005
29 2006-05-15     1   10     505         5   2    290           1 2006 1.611111 209.9222222 134   2006
30 2007-04-30     2    6     282         5   2    338           0 2007 0.000000  46.8000000 119   2007
31 2009-04-07     1    3     121         4   3    288           0 2009 0.000000   2.5555556  96   2009
32 2009-04-14     1    4     177         5   7    240           1 2009 1.333333   8.7666667 103   2009
33 2011-04-19     3    4     179         6   4    264           3 2011 4.400000  20.0666667 108   2011
34 2012-03-30     2    1      34         3   3    280           0 2012 0.000000   0.0000000  89   2012
35 2013-04-12     1    3     145         4   4    300           0 2013 0.000000   5.1833333 101   2013
36 2013-04-26     1    5     257         5   3    201           0 2013 0.000000  76.7055556 115   2013
37 2013-05-13     1    8     393         5   2    240           0 2013 0.000000 204.5166667 132   2013
38 2013-05-13     2    8     394         5   3    190           0 2013 0.000000 204.5166667 132   2013
39 2014-04-16     2    4     186         5   3    186           4 2014 4.133333  36.5666667 105   2014


This notebook is used to extract data from original data files in the Excel format. Because the file format changes over time, each year is done separately. 

```{r setup}
rm(list=ls())
library(tidyverse)
library(lubridate)
library(readxl)
source("Piedras_Blancas_fcns.R")

data.dir <- "data/All data/"
#out.dir <- "data/Processed data/"    # completed in May 2022 but needs revisions
out.dir <- "data/Processed data v2/"  # for revising outputs

extract.all.vars <- function(x) {
  x %>%
    mutate(Date = Date.date) %>%
    select(-c(Date.date, Date.char)) %>%
    relocate(Date)
}

extract.shift.vars <- function(x) {
  x %>%
  select(Date.char, Shift, Effort, Mother_Calf, Sea_State, Vis) %>%
  transmute(Date = Date.char,
            Shift = Shift,
            Sea_State = Sea_State,
            Vis = Vis,
            Effort = Effort, 
            Mother_Calf = Mother_Calf) -> x.out
  return(x.out)
}
```


THIS FILE NEEDS TO BE UPDATED AND ANNOTATED BETTER. EACH YEAR HAS A DIFFERENT FORMAT SO ALL THE DIFFERENCES NEED TO BE DESCRIBED IN DETAILS. COMMON FUNCTIONS MAY NOT WORK SO WELL. CURRENTLY IT DOES NOT RUN. 2022-07-27

## 1994

```{r}
Year <- 1994
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "INSHORE LOG"
sheet.name.offshore <- NULL
col.types.inshore <- c("date", "numeric", "text", "numeric", "numeric",
                       "numeric", "numeric", "text", "text")

col.names.inshore <- c("Date", "Event", "Time", "Obs. Code", "Sea State",
                       "Vis. IN", "Cow  / Calf")

col.types.offshore <- c("date", "numeric", "text", "numeric", "numeric",
                        "numeric", "numeric", "numeric", "text", "text")

col.names.offshore <- c("Date", "Event", "Time", "Obs.", "Sea State",
                        "Vis. Code", "Cow/Calf", "Ad./Juv.")

data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4) %>% 
  extract.all.vars()
# There are some characters, e.g., ?, in columns that don't expect them. 
# Warnings return - Line 665

out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4) %>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```


## 1995

```{r}
Year <- 1995
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "Inshore Data"
sheet.name.offshore <- "Offshore Data"
col.types.inshore <- c("date", "numeric", "text", "numeric", "numeric", 
                       "numeric", "numeric", "numeric", "text", "text", 
                       "text", "text", "text", "text", "text", "text")

col.names.inshore <- c("Date",	"Event Code",	"Time",	"Observer Code",	
                       "Sea State",	"Vis In",	"C/C Pairs")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "numeric", "numeric", "numeric", 
                        "numeric", "numeric", "numeric", "text")


col.names.offshore <- c("Date",	"Event",	"Time",	"OBS.",
                        "Sea",	"Vis.",	"Cow/Calf")

data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()
# There are some characters, e.g., SN, step for observers, in columns that don't expect them. 
# Warnings return - quite a few. 

out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 7, 
                          end.hr = 19, 
                          max.shift = 4) %>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")



```



## 1996

```{r}
Year <- 1996
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "data"
sheet.name.offshore <- "Sheet1"
col.names.inshore <- c("DATE",	"EVENT CODE",	"TIME", "OBS.",	
                       "SEA STATE",	"VIS (IN/OUT)",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "numeric", "text", "text", "text", 
                       "text", "text")

col.names.offshore <- c("DATE",	"EVENT CODE",	"TIME", 	"OBS",
                        "VIS",	"SEA ST.",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "numeric", "numeric", "numeric", 
                        "numeric", "text",  "text")

data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()
# There are some characters, e.g., SN, step for observers, in columns that don't expect them. 
# Warnings return - quite a few. 

out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 7, 
                          end.hr = 19, 
                          max.shift = 4) %>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")


```



## 1997

```{r}
Year <- 1997
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT",	"TIME",	"OBSER" ,	
                       "VIS I/O",	"SEA STATE", "C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "numeric", "text", "text", 
                       "text", "text", "text", "text", 
                       "text", "text")

col.names.offshore <- c("DATE",	"EVENT CODE",	"TIME", "OBS",
                        "VIS", "S STATE",	"COW/CA")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "text", "numeric", 
                        "text", "text",  "numeric", "text")

data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()

out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4) %>% extract.shift.vars()

# Warnings with "no non-missing arguments" return when no Vis or SeaState are available in a data chunk
# They turn into NAs

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")


```



## 1998

```{r}
Year <- 1998
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOG"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("Date",	"Event Code",	"Time",	"Obs",
                       "Vis (I/O)", "Sea State",	"c/c"	)

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "numeric", "text", "text", "text", 
                       "text", "text")

col.names.offshore <- c("Date",	"Event Code",	"Time",	"Obs",	
                        "Vis",	"SeaState",	"c/c")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4) %>% extract.shift.vars()

# same as 1997. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```




## 1999

```{r}
Year <- 1999
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "DATA"
sheet.name.offshore <- "DATA"

col.names.inshore <- c("Date",	"Event Code",	"Time", 	"Obs. Code",
                       "Vis", "Sea State", "C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "numeric", "text", "text", "text",
                       "text", "text", "text")

# data.out <- read_excel(xls.file.name.inshore,
#                          sheet = sheet.name.inshore,
#                          col_types = col.types.inshore)
#                        
# data.inshore <- get.data(Year = Year,
#                            dir.name = dir.name,
#                            xls.file.name = xls.file.name.inshore,
#                            sheet.name = sheet.name.inshore,
#                            col.types = col.types.inshore,
#                            col.names = col.names.inshore,
#                            area.name = "inshore",
#                            start.time = start.time)

col.names.offshore <- c("Date",	"Event Code",	"Time",	"Observer",	
                        "Vis. Code",	"Sea State",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")
```



## 2000

```{r}
Year <- 2000
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "DATA"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT",	"TIME",	"OBS.",	
                       "VIS (IN/OUT)",	"SEA STATE",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

# data.out <- read_excel(xls.file.name.inshore,
#                          sheet = sheet.name.inshore,
#                          col_types = col.types.inshore)
#                        
# data.inshore <- get.data(Year = Year,
#                            dir.name = dir.name,
#                            xls.file.name = xls.file.name.inshore,
#                            sheet.name = sheet.name.inshore,
#                            col.types = col.types.inshore,
#                            col.names = col.names.inshore,
#                            area.name = "inshore",
#                            start.time = start.time)

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS.",
                        "VIS CODE",	"SEA STATE",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```



## 2001

```{r}
Year <- 2001
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT",	"TIME",	"OBS.",
                       "VIS I/O",	"SEA ST",	"C/C"	)

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

# data.out <- read_excel(xls.file.name.inshore,
#                          sheet = sheet.name.inshore,
#                          col_types = col.types.inshore)
#                        
# data.inshore <- get.data(Year = Year,
#                            dir.name = dir.name,
#                            xls.file.name = xls.file.name.inshore,
#                            sheet.name = sheet.name.inshore,
#                            col.types = col.types.inshore,
#                            col.names = col.names.inshore,
#                            area.name = "inshore",
#                            start.time = start.time)

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",
                        "VIS",	"SEA STATE",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```



## 2002

```{r}
Year <- 2002
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOG"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", 	"OBS",
                       "VIS (I/O)",	"SS",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

# data.inshore <- get.data(Year = Year,
#                            dir.name = dir.name,
#                            xls.file.name = xls.file.name.inshore,
#                            sheet.name = sheet.name.inshore,
#                            col.types = col.types.inshore,
#                            col.names = col.names.inshore,
#                            area.name = "inshore",
#                            start.time = start.time)

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",
                        "VIS",	"SS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```



## 2003

```{r}
Year <- 2003
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "Logs"
sheet.name.offshore <- "logs"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", 	"OBS",
                       "VIS (I/O)",	"SS",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

# data.inshore <- get.data(Year = Year,
#                            dir.name = dir.name,
#                            xls.file.name = xls.file.name.inshore,
#                            sheet.name = sheet.name.inshore,
#                            col.types = col.types.inshore,
#                            col.names = col.names.inshore,
#                            area.name = "inshore",
#                            start.time = start.time)

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",
                        "VIS",	"SS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")


```



## 2004

```{r}
Year <- 2004
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

sheet.name.inshore <- "DATA"
sheet.name.offshore <- "DATA"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", 	"OBS",
                       "VIS (I/O)",	"SS",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

# data.inshore <- get.data(Year = Year,
#                            dir.name = dir.name,
#                            xls.file.name = xls.file.name.inshore,
#                            sheet.name = sheet.name.inshore,
#                            col.types = col.types.inshore,
#                            col.names = col.names.inshore,
#                            area.name = "inshore",
#                            start.time = start.time)

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```



## 2005

```{r}
Year <- 2005
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", 	"OBS",
                       "VIS (I/O)",	"SS",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text")

# data.out <- read_excel(xls.file.name.inshore,
#                          sheet = sheet.name.inshore,
#                          col_types = col.types.inshore)

# data.inshore <- get.data(Year = Year,
#                          dir.name = dir.name,
#                          xls.file.name = xls.file.name.inshore,
#                          sheet.name = sheet.name.inshore,
#                          col.types = col.types.inshore,
#                          col.names = col.names.inshore,
#                          area.name = "inshore",
#                          start.time = start.time)

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")
```




## 2006

```{r}
Year <- 2006
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```



## 2007

```{r}
Year <- 2007
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "log"
sheet.name.offshore <- "log"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text", "text")

# data.out <- read_excel(xls.file.name.inshore,
#                          sheet = sheet.name.inshore,
#                          col_types = col.types.inshore)

# data.inshore <- get.data(Year = Year,
#                          dir.name = dir.name,
#                          xls.file.name = xls.file.name.inshore,
#                          sheet.name = sheet.name.inshore,
#                          col.types = col.types.inshore,
#                          col.names = col.names.inshore,
#                          area.name = "inshore",
#                          start.time = start.time)


col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```




## 2008

```{r}
Year <- 2008
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOG"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```


## 2009

```{r}
Year <- 2009
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")


col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```


Files seem to be about the same from these years... 



## 2010

```{r}
Year <- 2010
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")


col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")
```



## 2011

```{r}
Year <- 2011
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")


col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```



## 2012

```{r}
Year <- 2012
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")


col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```



## 2013

```{r}
Year <- 2013
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")


col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")


data.all <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                          col.types.inshore, col.types.offshore,
                          col.names.inshore, col.names.offshore,
                          Year, xls.file.name.inshore, xls.file.name.offshore,
                          start.time, max.shift = 4)%>% 
  extract.all.vars()


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")

out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data v2/", 
                                  Year, " Formatted.csv")

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 6.5, 
                          end.hr = 19, 
                          max.shift = 4)%>% extract.shift.vars()

# same as before. Vis and SeaState are probably not filled in. 

formatted.all.data <- format.output(data.shift, max.shift = 4)

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all)

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift)

if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")
```



## 2014

```{r}
Year <- 2014
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")

xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

start.hr <- 7
end.hr <- 19
max.shift <- 4

data.inshore <- get.data(Year = Year,
                         xls.file.name = xls.file.name.inshore,
                         sheet.name = sheet.name.inshore, 
                         col.types = col.types.inshore,
                         col.names = all_of(col.names.inshore),
                         start.time = start.time,
                         max.shift = max.shift)

data.offshore <- get.data(Year = Year,
                          xls.file.name = xls.file.name.offshore,
                          sheet.name = sheet.name.offshore,
                          col.types = col.types.offshore,
                          col.names = all_of(col.names.offshore),
                          start.time = start.time, 
                          max.shift = 4)

data.offshore %>% 
  filter(Mother_Calf > 0) %>%
  rbind(data.inshore) %>%
  arrange(Date.date, Minutes_since_0000) %>% 
  extract.all.vars() -> data.all

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = start.hr, 
                          end.hr = end.hr, 
                          max.shift = max.shift)%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max.shift)

out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")
out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data/", 
                                  Year, " Formatted.csv")

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all,
            quote = "none")

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")


```


## 2015

```{r}
Year <- 2015
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")

xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")
start.hr <- 7
end.hr <- 19
max.shift <- 4

data.inshore <- get.data(Year = Year,
                         xls.file.name = xls.file.name.inshore,
                         sheet.name = sheet.name.inshore, 
                         col.types = col.types.inshore,
                         col.names = all_of(col.names.inshore),
                         start.time = start.time,
                         max.shift = max.shift)

data.offshore <- get.data(Year = Year,
                          xls.file.name = xls.file.name.offshore,
                          sheet.name = sheet.name.offshore,
                          col.types = col.types.offshore,
                          col.names = all_of(col.names.offshore),
                          start.time = start.time, 
                          max.shift = 4)

data.offshore %>% 
  filter(Mother_Calf > 0) %>%
  rbind(data.inshore) %>%
  arrange(Date.date, Minutes_since_0000) %>% 
  extract.all.vars() -> data.all

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = start.hr, 
                          end.hr = end.hr, 
                          max.shift = max.shift)%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max.shift)

out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")
out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data/", 
                                  Year, " Formatted.csv")

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all,
            quote = "none")

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")


```



## 2016

```{r}
Year <- 2016
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- NULL

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

start.hr <- 7
end.hr <- 19
max.shift <- 4

data.inshore <- get.data(Year = Year,
                         xls.file.name = xls.file.name.inshore,
                         sheet.name = sheet.name.inshore, 
                         col.types = col.types.inshore,
                         col.names = all_of(col.names.inshore),
                         start.time = start.time,
                         max.shift = max.shift)

data.offshore <- get.data(Year = Year,
                          xls.file.name = xls.file.name.offshore,
                          sheet.name = sheet.name.offshore,
                          col.types = col.types.offshore,
                          col.names = all_of(col.names.offshore),
                          start.time = start.time, 
                          max.shift = 4)

# Effort can be different between inshore and offshore, so they have to be 
# computed separately...
# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R

data.offshore %>% 
  filter(Mother_Calf > 0) %>%
  rbind(data.inshore) %>%
  arrange(Date.date, Minutes_since_0000) %>% 
  extract.all.vars()-> data.all

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = start.hr, 
                          end.hr = end.hr, 
                          max.shift = max.shift) %>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max.shift)

# data.shift.inshore <- find.effort(data.inshore, 
#                                   start.hr = start.hr, 
#                                   end.hr = end.hr, 
#                                   max.shift = max.shift)
# 
# formatted.inshore.data <- format.output(data.shift.inshore, max.shift = max.shift)
# 
# data.shift.offshore <- find.effort(data.offshore, 
#                                   start.hr = start.hr, 
#                                   end.hr = end.hr, 
#                                   max.shift = max.shift)
# 
# formatted.offshore.data <- format.output(data.shift.offshore, max.shift = max.shift)
# 
# data.offshore %>% 
#   filter(Mother_Calf > 0) %>%
#   rbind(data.inshore) %>%
#   arrange(Date.date, Minutes_since_0000) -> data.all


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")
out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data/", 
                                  Year, " Formatted.csv")

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all,
            quote = "none")

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")
```


## 2017

No offshore log exists for 2017
```{r}
Year <- 2017
dir.name <- paste0("C_C ", Year)
start.time <- "0700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

sheet.name <- "LOGS"

col.names <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
               "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types <- c("date", "numeric", "text", "text", 
               "numeric", "text", "numeric", "numeric", 
               "text", "text", "text", "text", 
               "text", "text", "text", "text",
               "text", "text")

start.hr <- 7
end.hr <- 19
max.shift <- 4

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = start.hr, 
                          end.hr = end.hr, 
                          max.shift = max.shift) %>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max.shift)

out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")
out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data/", 
                                  Year, " Formatted.csv")

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all,
            quote = "none")

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")


```



## 2018

No offshore log exists for 2018
```{r}
Year <- 2018
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

sheet.name <- "LOGS"

col.names <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
               "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types <- c("numeric", "date", "numeric", "text", "text", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text", "text",
                       "text", "text", "text", "text")

start.hr <- 7
end.hr <- 19
max.shift <- 4

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = start.hr, 
                          end.hr = end.hr, 
                          max.shift = max.shift) %>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max.shift)


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")
out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data/", 
                                  Year, " Formatted.csv")

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all,
            quote = "none")

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")


```





## 2019

No offshore log exists for 2019
```{r}
Year <- 2019
dir.name <- paste0("C_C ", Year)
start.time <- "700"

xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

# Event for 4/29/2019 at 1845 was changed from "1" to "4". 2022-06-24
# Event for 5/9/2019 at 0830 was changed from "1" to "3". 2022-06-24
# Event for 5/23/2019 at 1200 was changed from "1" to "3". 2022-06-24

sheet.name <- "INSHORE LOGS"

col.names <- c("DATE",	"EVENT", 	"TIME",	"OBS #",
               "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types <- c("date", "numeric", "numeric", "text", "text", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text", "text",
                       "text", "text", "text")

start.hr <- 7
end.hr <- 19
max.shift <- 4

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = start.hr, 
                          end.hr = end.hr, 
                          max.shift = max.shift) %>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max.shift)


out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")
out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data/", 
                                  Year, " Formatted.csv")

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all,
            quote = "none")

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")


```


No data for 2020 - COVID.

## 2021

```{r}
Year <- 2021
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

# Event for 4/20/2021 at 745 was changed from "3" to "5". 2022-06-24
sheet.name <- "INSHORE LOGS"

col.names <- c("DATE",	"EVENT", 	"TIME",	"OBS #",
                       "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types <- c("date", "numeric", "numeric", "text", "text", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text", "text",
                       "text", "text", "text", "text", "text")

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 7, 
                          end.hr = 19, 
                          max.shift = 4) %>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = 4)

out.file.name.all <- paste0(out.dir, "Processed_all_data_", 
                            Year, ".csv")
out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data/", 
                                  Year, " Formatted.csv")

if (!file.exists(out.file.name.all))
  write_csv(data.all,
            file = out.file.name.all,
            quote = "none")

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```


## 2022

For 2022 and beyond, I added some code here to skip using Collating and Formatting v2.R. It's much easier to get all necessary steps done here, directly out of Excel input files than going through many scripts. 

```{r}
# PROBLEM WITH AT LEAST ONE SHIFT 2022-03-28 ENDING/STARTING AT NOT EXACTLY AT THE 
# TOP OF THE HOUR (1558 INSTEAD OF 1600). THIS SHOULD BE EDITED IN THE DATA FILE. 
# CONTINUE HERE 2022-06-22  -> IT HAS BEEN EDITED TO 1600 2022-06-23

Year <- 2022
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

sheet.name <- "MomCalf Logs 2022 postQC"
# c("Date", "Event", "Time", "Obs. Code", 
#  "Sea State", "Vis. IN", "Cow  / Calf")

# These are not the names of all columns. These are the names of columns in the
# spreadsheet that are needed. These names change among years, so they need to
# be specified for each year.
col.names <- c("DATE", 	"EVENT", 	"TIME",	"OBS #",
               "SEA ST", "VIS IN", "M/C", "LOCATION (IN/OFF)")

# these are column types of all columns in the spreadsheet. 
col.types <- c("date", "numeric", "numeric", "text", "text", 
               "numeric", "numeric", "numeric", "numeric", "text", 
               "text", "text", "text", "numeric", "text", 
               "text", "text", "text")

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, 
                          start.hr = 7, 
                          end.hr = 19, 
                          max.shift = 4) %>% extract.shift.vars() 

formatted.all.data <- format.output(data.shift, max.shift = 4)

out.file.name.all <- paste0(out.dir, "Processed_all_data_",
                            Year, ".csv")
out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                              Year, ".csv")

out.file.name.formatted <- paste0("data/Formatted Annual Data/", 
                                  Year, " Formatted.csv")

if (!file.exists(out.file.name.all))
  write_csv(data.all ,
            file = out.file.name.all,
            quote = "none")

if (!file.exists(out.file.name.shift))
  write_csv(data.shift,
            file = out.file.name.shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(out.file.name.formatted))
  write_csv(formatted.all.data,
            file = out.file.name.formatted, 
            quote = "none",
            na = "")

```

