---
title: "R Notebook"
output: html_notebook
---

This notebook is used to extract data from original data files in the Excel format. Because the file format changes over time, each year is done separately. 

```{r setup}
rm(list=ls())
library(tidyverse)
library(lubridate)
library(readxl)
source("Piedras_Blancas_fcns.R")

data.dir <- "data/All data/"
#out.dir <- "data/Processed data/"    # completed in May 2022 but needs revisions

# v3 includes the new shift definitions
ver <- "v3"  # v2

out.dir <- paste0("data/Processed data ", ver, "/")  # for revising outputs
out.formatted.dir <- paste0("data/Formatted Annual Data ", ver, "/")

# Regardless of if output file exists, this will overwrite the output files
save.files <- TRUE
start.time <- "100"   # This is for v3. For v2, should be year specific.


```

Event code:
1 = START EFFORT
2 = CHANGE OBSERVERS
3 = CHANGE SIGHTING CONDITIONS
4 = GRAY WHALE SIGHTING
5 = END EFFORT
6 = OTHER SPECIES SIGHTING


THIS FILE NEEDS TO BE UPDATED AND ANNOTATED BETTER. EACH YEAR HAS A DIFFERENT FORMAT SO ALL THE DIFFERENCES NEED TO BE DESCRIBED IN DETAILS. COMMON FUNCTIONS MAY NOT WORK SO WELL. CURRENTLY IT DOES NOT RUN. 2022-07-27

2023-05-09 WHEN THERE ARE ONLY 4 SHIFTS, BUT DATA EXTRACTION WAS SET TO 5 SHIFTS, THE LAST SHIFT GETS FULL 3 HOURS EVEN THOUGH THERE WERE NO EFFORT. THIS NEEDS TO BE FIXED IN THE get.data FUNCTION. 

2023-06-01 A HA MOMENT. RATHER THAN MAKING ARBITRARY STARTING TIME OF 0630 OR 0700, CREATE 3-HR SHIFTS STARTING FROM 0100. 

NEW FUNCTIONS WERE CREATED AND TESTED. THE NEXT CHUNK WILL RUN ALL YEARS. 

```{r}
years <- c(1994:2019, 2021:2023)
inshore.xls.file.idx <- c(1,1,1,1,1,1,1,1,1,1,2,1,1,1,1,1,2,2,2,1,1,1,1,1,1,1,1,1,1)
offshore.xls.file.idx <- c(2,2,2,2,2,2,2,2,2,2,3,2,2,2,2,2,3,3,3,2,2,3,2,NA,NA,NA,NA,NA,NA)

for (k in 24:length(years)){
  Year <- years[k]
  dir.name <- paste0("C_C ", Year)
  
  xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
  xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[inshore.xls.file.idx[k]])
  if (!is.na(offshore.xls.file.idx[k])){
    xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[offshore.xls.file.idx[k]])
    
  }
  
  idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
  if (Year < 2017){
    out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                             list.sheet.names.offshore[[idx.list]],
                             list.col.types.inshore[[idx.list]], 
                             list.col.types.offshore[[idx.list]],
                             list.col.names.inshore[[idx.list]], 
                             list.col.names.offshore[[idx.list]],
                             Year, 
                             xls.file.name.inshore, xls.file.name.offshore,
                             start.time)
    
  } else {
    out.list <- get.data.inshore.only(Year = Year,
                                      xls.file.name = xls.file.name.inshore,
                                      sheet.name = list.sheet.names.inshore[[idx.list]],
                                      col.types = list.col.types.inshore[[idx.list]],
                                      col.names = list.col.names.inshore[[idx.list]],
                                      start.time = start.time)
  }
  
  if (save.files){
    # Creates file names and saves files
    files <- file.names(out.dir = out.dir, 
                        ver = ver, 
                        Year = Year, 
                        out.list = out.list)
    
  }
  
  
}

```

THE FOLLOWING CHUNKS ARE NEEDED FOR NOTES ON HOW DATA FILES WERE EDITED AFTER GOING THROUGH THEM. BUT NO NEED TO RUN THEM FOR EXTRACTING DATA. 

## 1994

```{r}
Year <- 1994
# Inshore
# G665 ?? deleted in Cow / Calf column 2023-05-08
# C1164 Changed 130 to 730 in Time column 2023-05-08
# C1508 Changed 155 to 1155 in Time column 2023-05-08

# Offshore
# C509 Changed 328 to 628 in Time column 2023-05-08

dir.name <- paste0("C_C ", Year)
#start.time <- "630" 

xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir = out.dir, 
                      ver = ver, 
                      Year = Year, 
                      out.list = out.list)
  
}


```


## 1995

```{r}
# Inshore:
# D1056, D1064 Observer code SN, changed to 11
# D1069, D1080 Observer code steph, changed to 12 
# Row 1221 TOTALS 189 (col H), 72 (col I), 57 (col J) deleted.

# Offshore:
# D740, D747 Observer code SN, changed to 11
# D752, D760 Observer code steph, changed to 12 


Year <- 1995
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
    files <- file.names(out.dir = out.dir, 
                      ver = ver, 
                      Year = Year, 
                      out.list = out.list)

  
}



```



## 1996


```{r}
# Inshore:
# Rows 1268-1283, DATE is 1/21/1996. Changed to 5/21/1996

# Offshore:
# Rows 611-625, DATE is 1/16/1996. Changed to 4/16/1996

Year <- 1996
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)
if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir = out.dir, 
                      ver = ver, 
                      Year = Year, 
                      out.list = out.list)

  
}



```



## 1997

```{r}
# Inshore:
# Row 838 TIME was 100. Changed to 1100. 2023-05-08

Year <- 1997
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir = out.dir, 
                      ver = ver, 
                      Year = Year, 
                      out.list = out.list)

  
}


```



## 1998 

```{r}
# Inshore:
# Row 388 Time 100 has been changed to 1000 2023-05-09


Year <- 1998
dir.name <- paste0("C_C ", Year)
#start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)
if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}

 
```




## 1999

```{r}
# Inshore:
# Row 395 Time = 100, changed to 1200 2023-05-09

# Offshore
# Row 997 Time = 100. changed to 1300 2023-05-09

Year <- 1999
dir.name <- paste0("C_C ", Year)
#start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```



## 2000

```{r}

Year <- 2000
dir.name <- paste0("C_C ", Year)
#start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)



if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}



```



## 2001

```{r}
# Inshore:
# Row 838 Time = 8.3. Changed to 830. 2023-05-09


# Offshore:
# Row 898 Time = 147. Changed to 1547. 2023-05-09
# Row 458 Time = 13321. Changed to 1332. 2023-05-09
# Row 921 Time = 130. Changed to 1730 (could be 1830). 2023-05-09


Year <- 2001
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)
if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```



## 2002

```{r}

Year <- 2002
dir.name <- paste0("C_C ", Year)
#start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)
if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```



## 2003

```{r}
# Inshore:
# Row 368. Time = 700. Changed to 900.

Year <- 2003
dir.name <- paste0("C_C ", Year)
#start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}



```



## 2004

```{r}

Year <- 2004
dir.name <- paste0("C_C ", Year)
#start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```



## 2005

```{r}

Year <- 2005
dir.name <- paste0("C_C ", Year)
#start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```




## 2006

```{r}
# Offshore:
# Row 437 Time = 9.9. Changed to 939. 3 is closest to decimal point. 2023-05-09

Year <- 2006
dir.name <- paste0("C_C ", Year)
#start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}



```



## 2007

```{r}

Year <- 2007
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```




## 2008

```{r}

Year <- 2008
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```


## 2009

```{r}

Year <- 2009
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```


Files seem to be about the same from these years... 



## 2010

```{r}

Year <- 2010
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```



## 2011

```{r}

Year <- 2011
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}



```



## 2012

```{r}
# Inshore:
# Row 311 TIME = 100. Changed to 1600. 2023-05-09

Year <- 2012
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```



## 2013

```{r}
# Inshore:
# Row 613 Time = 741. Changed to 941. 2023-05-11

# Offshore:
# Row 450 TIME = 100. Changed to 1600. 2023-05-09

Year <- 2013
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```



## 2014

```{r}

Year <- 2014
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")

xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}



```


## 2015

```{r}
# Row 617 TIME = 100. Changed to 1000. 2023-05-09

Year <- 2015
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")

xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```



## 2016

```{r}
# Offshore:
# Row 207 TIME = 110. Changed to 1100. 2023-05-09

Year <- 2016
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))
out.list <- get.all.data(list.sheet.names.inshore[[idx.list]], 
                         list.sheet.names.offshore[[idx.list]],
                         list.col.types.inshore[[idx.list]], 
                         list.col.types.offshore[[idx.list]],
                         list.col.names.inshore[[idx.list]], 
                         list.col.names.offshore[[idx.list]],
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```


## 2017

No offshore log exists for 2017
```{r}
# Inshore:
# Row 29: TIME = 83o. Changed to 830. 2023-05-09

Year <- 2017
dir.name <- paste0("C_C ", Year)
#start.time <- "0700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))

# get the data using get.data.inshore.only function, which is in Piedras_Blancas_fcns.R
out.list <- get.data.inshore.only(Year = Year,
                                     xls.file.name = xls.file.name.inshore,
                                     sheet.name = list.sheet.names.inshore[[idx.list]],
                                     col.types = list.col.types.inshore[[idx.list]],
                                     col.names = list.col.names.inshore[[idx.list]],
                                     start.time = start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}



```



## 2018

No offshore log exists for 2018
```{r}
Year <- 2018
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))

# get the data using get.data.inshore.only function, which is in Piedras_Blancas_fcns.R
out.list <- get.data.inshore.only(Year = Year,
                                     xls.file.name = xls.file.name.inshore,
                                     sheet.name = list.sheet.names.inshore[[idx.list]],
                                     col.types = list.col.types.inshore[[idx.list]],
                                     col.names = list.col.names.inshore[[idx.list]],
                                     start.time = start.time)

# # get the data using get.data function, which is in Piedras_Blancas_fcns.R
# data.inshore <- get.data(Year = Year,
#                      xls.file.name = xls.file.name.inshore,
#                      sheet.name = list.sheet.names.inshore[[idx.list]],
#                      col.types = list.col.types.inshore[[idx.list]],
#                      col.names = list.col.names.inshore[[idx.list]],
#                      start.time = start.time) %>%
#   extract.all.vars()
# 
# # calculate effort and other statistics per 3-hr shift, using find.effort
# # function in Piedras_Blancas_fcns.R
# data.shift <- find.effort(data.inshore, T0 = start.time) #%>% extract.shift.vars()
# 
# formatted.inshore <- format.output(data.shift$out.df, 
#                                    max.shift = max(data.shift$out.df$Shift))
# 
# out.list <- list(data.offshore = NULL,
#                  data.inshore = data.inshore,
#                  shift.data.offshore = NULL,
#                  shift.data.inshore = data.shift$out.df,
#                  formatted.data.offshore = NULL,
#                  formatted.data.inshore = formatted.inshore)


if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```





## 2019

No offshore log exists for 2019
```{r}
# Event for 4/29/2019 at 1845 was changed from "1" to "4". 2022-06-24
# Event for 5/9/2019 at 0830 was changed from "1" to "3". 2022-06-24
# Event for 5/23/2019 at 1200 was changed from "1" to "3". 2022-06-24

Year <- 2019
dir.name <- paste0("C_C ", Year)
#start.time <- "700"

xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))

# get the data using get.data.inshore.only function, which is in Piedras_Blancas_fcns.R
out.list <- get.data.inshore.only(Year = Year,
                                     xls.file.name = xls.file.name.inshore,
                                     sheet.name = list.sheet.names.inshore[[idx.list]],
                                     col.types = list.col.types.inshore[[idx.list]],
                                     col.names = list.col.names.inshore[[idx.list]],
                                     start.time = start.time)

# # get the data using get.data function, which is in Piedras_Blancas_fcns.R
# data.inshore <- get.data(Year = Year,
#                      xls.file.name = xls.file.name.inshore,
#                      sheet.name = list.sheet.names.inshore[[idx.list]],
#                      col.types = list.col.types.inshore[[idx.list]],
#                      col.names = list.col.names.inshore[[idx.list]],
#                      start.time = start.time) %>%
#   extract.all.vars()
# 
# # calculate effort and other statistics per 3-hr shift, using find.effort
# # function in Piedras_Blancas_fcns.R
# data.shift <- find.effort(data.inshore, T0 = start.time) #%>% extract.shift.vars()
# 
# formatted.inshore <- format.output(data.shift$out.df, 
#                                    max.shift = max(data.shift$out.df$Shift))
# 
# out.list <- list(data.offshore = NULL,
#                  data.inshore = data.inshore,
#                  shift.data.offshore = NULL,
#                  shift.data.inshore = data.shift$out.df,
#                  formatted.data.offshore = NULL,
#                  formatted.data.inshore = formatted.inshore)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```


No data for 2020 - COVID.

## 2021

```{r}

# Event for 4/20/2021 at 745 was changed from "3" to "5". 2022-06-24
Year <- 2021
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))

# get the data using get.data.inshore.only function, which is in Piedras_Blancas_fcns.R
out.list <- get.data.inshore.only(Year = Year,
                                     xls.file.name = xls.file.name.inshore,
                                     sheet.name = list.sheet.names.inshore[[idx.list]],
                                     col.types = list.col.types.inshore[[idx.list]],
                                     col.names = list.col.names.inshore[[idx.list]],
                                     start.time = start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```


## 2022


```{r}
# PROBLEM WITH AT LEAST ONE SHIFT 2022-03-28 ENDING/STARTING AT NOT EXACTLY AT THE 
# TOP OF THE HOUR (1558 INSTEAD OF 1600). THIS SHOULD BE EDITED IN THE DATA FILE. 
# CONTINUE HERE 2022-06-22  -> IT HAS BEEN EDITED TO 1600 2022-06-23

Year <- 2022
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))

# get the data using get.data.inshore.only function, which is in Piedras_Blancas_fcns.R
out.list <- get.data.inshore.only(Year = Year,
                                     xls.file.name = xls.file.name.inshore,
                                     sheet.name = list.sheet.names.inshore[[idx.list]],
                                     col.types = list.col.types.inshore[[idx.list]],
                                     col.names = list.col.names.inshore[[idx.list]],
                                     start.time = start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```


## 2023 


```{r}

Year <- 2023
dir.name <- paste0("C_C ", Year)
#start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

idx.list <- which(names(list.sheet.names.inshore) == paste0("Y", Year))

# get the data using get.data.inshore.only function, which is in Piedras_Blancas_fcns.R
out.list <- get.data.inshore.only(Year = Year,
                                     xls.file.name = xls.file.name.inshore,
                                     sheet.name = list.sheet.names.inshore[[idx.list]],
                                     col.types = list.col.types.inshore[[idx.list]],
                                     col.names = list.col.names.inshore[[idx.list]],
                                     start.time = start.time)

if (save.files){
  # Creates file names and saves files
  files <- file.names(out.dir, Year, out.list)
  
}


```
