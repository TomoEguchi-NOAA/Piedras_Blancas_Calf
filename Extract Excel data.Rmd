---
title: "R Notebook"
output: html_notebook
---

This notebook is used to extract data from original data files in the Excel format. Because the file format changes over time, each year is done separately. 

```{r setup}
rm(list=ls())
library(tidyverse)
library(lubridate)
library(readxl)
source("Piedras_Blancas_fcns.R")

data.dir <- "data/All data/"
#out.dir <- "data/Processed data/"    # completed in May 2022 but needs revisions
out.dir <- "data/Processed data v2/"  # for revising outputs
out.formatted.dir <- "data/Formatted Annual Data v2/"

extract.all.vars <- function(x) {
  x %>%
    mutate(Date = Date.date) %>%
    select(-c(Date.date, Date.char)) %>%
    relocate(Date)
}

extract.shift.vars <- function(x) {
  x %>%
  select(Date.char, Shift, Effort, Mother_Calf, Sea_State, Vis) %>%
  transmute(Date = Date.char,
            Shift = Shift,
            Sea_State = Sea_State,
            Vis = Vis,
            Effort = Effort, 
            Mother_Calf = Mother_Calf) -> x.out
  return(x.out)
}

file.names <- function(out.dir, Year){
  out.file.name.all <- paste0(out.dir, "Processed_all_data_",
                              Year, ".csv")
  out.file.name.shift <- paste0(out.dir, "Processed_by_shift_data_", 
                                Year, ".csv")
  
  out.file.name.formatted <- paste0(out.formatted.dir,
                                    Year, " Formatted.csv")

  file.names <- list(all = out.file.name.all,
                     shift = out.file.name.shift,
                     formatted = out.file.name.formatted)
  return(file.names)
}

```

Event code:
1 = START EFFORT
2 = CHANGE OBSERVERS
3 = CHANGE SIGHTING CONDITIONS
4 = GRAY WHALE SIGHTING
5 = END EFFORT
6 = OTHER SPECIES SIGHTING


THIS FILE NEEDS TO BE UPDATED AND ANNOTATED BETTER. EACH YEAR HAS A DIFFERENT FORMAT SO ALL THE DIFFERENCES NEED TO BE DESCRIBED IN DETAILS. COMMON FUNCTIONS MAY NOT WORK SO WELL. CURRENTLY IT DOES NOT RUN. 2022-07-27

## 1994

```{r}
Year <- 1994
# Inshore
#G665 ?? deleted in Cow / Calf column 2023-05-08
# C1164 Changed 130 to 730 in Time column 2023-05-08
# C1508 Chagned 155 to 1155 in Time column 2023-05-08

# Offshore
# C509 Changed 328 to 628 in Time column 2023-05-08

dir.name <- paste0("C_C ", Year)
start.time <- "630"

xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "INSHORE LOG"
sheet.name.offshore <- NULL
col.types.inshore <- c("date", "numeric", "text", "numeric", "numeric",
                       "numeric", "numeric", "text", "text")

col.names.inshore <- c("Date", "Event", "Time", "Obs. Code", "Sea State",
                       "Vis. IN", "Cow  / Calf")

col.types.offshore <- c("date", "numeric", "text", "numeric", "numeric",
                        "numeric", "numeric", "numeric", "text", "text")

col.names.offshore <- c("Date", "Event", "Time", "Obs.", "Sea State",
                        "Vis. Code", "Cow/Calf")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```


## 1995

```{r}
# Inshore:
# D1056, D1064 Observer code SN, changed to 11
# D1069, D1080 Observer code steph, changed to 12 
# Row 1221 TOTALS 189 (col H), 72 (col I), 57 (col J) deleted.

# Offshore:
# D740, D747 Observer code SN, changed to 11
# D752, D760 Observer code steph, changed to 12 

Year <- 1995
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "Inshore Data"
sheet.name.offshore <- "Offshore Data"
col.types.inshore <- c("date", "numeric", "text", "numeric", "numeric", 
                       "numeric", "numeric", "numeric", "text", "text", 
                       "text", "text", "text", "text", "text", "text")

col.names.inshore <- c("Date",	"Event Code",	"Time",	"Observer Code",	
                       "Sea State",	"Vis In",	"C/C Pairs")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "numeric", "numeric", "numeric", 
                        "numeric", "text", "numeric", "text")

col.names.offshore <- c("Date",	"Event",	"Time",	"OBS.", 
                        "Sea", "Vis.", 	"Cow/Calf")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")



```



## 1996


```{r}
# Inshore:
# Rows 1268-1283, DATE is 1/21/1996. Changed to 5/21/1996

# Offshore:
# Rows 611-625, DATE is 1/16/1996. Changed to 4/16/1996

Year <- 1996
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

# c("Date", "Event", "Time", "Obs. Code", 
# "Sea State", "Vis. IN", "Cow  / Calf")

sheet.name.inshore <- "data"
sheet.name.offshore <- "Sheet1"
col.names.inshore <- c("DATE",	"EVENT CODE",	"TIME", "OBS.",	
                       "SEA STATE",	"VIS (IN/OUT)",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "numeric", "text", "text", 
                       "text", "text", "text")


col.names.offshore <- c("DATE",	"EVENT CODE",	"TIME", 	"OBS",
                       	"SEA ST.", "VIS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "numeric", "numeric", "numeric", 
                        "numeric", "text",  "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")


```



## 1997

```{r}
# Inshore:
# Row 838 TIME was 100. Changed to 1100. 2023-05-08


Year <- 1997
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", "OBSER", 
                       "SEA STATE", "VIS I/O", "C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", "numeric", 
                       "numeric", "text", "text", "text", 
                       "text", "numeric", "text", "text", 
                       "text")

col.names.offshore <- c("DATE",	"EVENT CODE",	"TIME", "OBS",
                        "S STATE", "VIS", "COW/CA")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "text", "numeric", 
                        "text", "text",  "numeric", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")


```



## 1998 START HERE 2023-05-08

```{r}
# Inshore:
# Row 388 Time 100 has been changed to 1000 2023-05-09


Year <- 1998
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOG"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("Date",	"Event Code",	"Time",	"Obs",
                       "Vis (I/O)", "Sea State",	"c/c"	)

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "numeric", "text", "text", "text", 
                       "text", "text")

col.names.offshore <- c("Date",	"Event Code",	"Time",	"Obs",	
                        "Vis",	"SeaState",	"c/c")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")
  
out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```




## 1999

```{r}
# Inshore:
# Row 395 Time = 100, changed to 1200 2023-05-09

# Offshore
# Row 997 Time = 100. changed to 1300 2023-05-09

Year <- 1999
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "DATA"
sheet.name.offshore <- "DATA"

col.names.inshore <- c("Date",	"Event Code",	"Time", 	"Obs. Code",
                       "Vis", "Sea State", "C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "numeric", "text", "text", "text",
                       "text", "text", "text")

col.names.offshore <- c("Date",	"Event Code",	"Time",	"Observer",	
                        "Vis. Code",	"Sea State",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")
```



## 2000

```{r}
Year <- 2000
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "DATA"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT",	"TIME",	"OBS.",	
                       "VIS (IN/OUT)",	"SEA STATE",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS.",
                        "VIS CODE",	"SEA STATE",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```



## 2001

```{r}
# Inshore:
# Row 838 Time = 8.3. Changed to 830. 2023-05-09


# Offshore:
# Row 898 Time = 147. Changed to 1547. 2023-05-09
# Row 458 Time = 13321. Changed to 1332. 2023-05-09
# Row 921 Time = 130. Changed to 1730 (could be 1830). 2023-05-09


Year <- 2001
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT",	"TIME",	"OBS.",
                       "VIS I/O",	"SEA ST",	"C/C"	)

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",
                        "VIS",	"SEA STATE",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```



## 2002

```{r}
Year <- 2002
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOG"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", 	"OBS",
                       "VIS (I/O)",	"SS",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",
                        "VIS",	"SS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```



## 2003

```{r}
Year <- 2003
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "Logs"
sheet.name.offshore <- "logs"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", 	"OBS",
                       "VIS (I/O)",	"SS",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",
                        "VIS",	"SS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")


```



## 2004

```{r}
Year <- 2004
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

sheet.name.inshore <- "DATA"
sheet.name.offshore <- "DATA"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", 	"OBS",
                       "VIS (I/O)",	"SS",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text",
                       "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)


files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```



## 2005

```{r}
Year <- 2005
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT",	"TIME", 	"OBS",
                       "VIS (I/O)",	"SS",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SS",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")
```




## 2006

```{r}
# Offshore:
# Row 437 Time = 9.9. Changed to 939. 3 is closest to decimal point. 2023-05-09

Year <- 2006
dir.name <- paste0("C_C ", Year)
start.time <- "630"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```



## 2007

```{r}
Year <- 2007
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "log"
sheet.name.offshore <- "log"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```




## 2008

```{r}
Year <- 2008
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOG"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```


## 2009

```{r}
Year <- 2009
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```


Files seem to be about the same from these years... 



## 2010

```{r}
Year <- 2010
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 5)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")
```



## 2011

```{r}
Year <- 2011
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 4)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```



## 2012

```{r}
# Inshore:
# Row 311 TIME = 100. Changed to 1600. 2023-05-09

Year <- 2012
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[2])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[3])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 4)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```



## 2013

```{r}
# Offshore:
# Row 450 T"IME = 100. Changed to 1600. 2023-05-09

Year <- 2013
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[2])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 4)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all)

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift)

if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")
```



## 2014

```{r}
Year <- 2014
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")

xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 4)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all,
            quote = "none")

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")


```


## 2015

```{r}
# Row 617 TIME = 100. Changed to 1000. 2023-05-09

Year <- 2015
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")

xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- "LOGS"

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 4)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all,
            quote = "none")

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")


```



## 2016

```{r}
# Offshore:
# Row 207 TIME = 110. Changed to 1100. 2023-05-09

Year <- 2016
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[grep("INSHORE", xls.files)])
xls.file.name.offshore <- paste0(data.dir, dir.name, "/", xls.files[grep("OFFSHORE", xls.files)])

sheet.name.inshore <- "LOGS"
sheet.name.offshore <- NULL

col.names.inshore <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
                       "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types.inshore <- c("date", "numeric", "text", "numeric", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text")

col.names.offshore <- c("DATE",	"EVENT",	"TIME",	"OBS",	
                        "VIS",	"SEA ST",	"C/C")

col.types.offshore <- c("date", "numeric", "text", "numeric", 
                        "numeric", "text", "numeric", "numeric", 
                        "text", "text",  "text", "text")

out.list <- get.all.data(sheet.name.inshore, sheet.name.offshore,
                         col.types.inshore, col.types.offshore,
                         col.names.inshore, col.names.offshore,
                         Year, 
                         xls.file.name.inshore, xls.file.name.offshore,
                         start.time, max.shift = 4)

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(out.list$data.all,
            file = files$all,
            quote = "none")

if (!file.exists(files$shift))
  write_csv(out.list$data.shift,
            file = files$shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(files$formatted))
  write_csv(out.list$formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")
```


## 2017

No offshore log exists for 2017
```{r}
# Inshore:
# Row 29: TIME = 83o. Changed to 830. 2023-05-09

Year <- 2017
dir.name <- paste0("C_C ", Year)
start.time <- "0700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

sheet.name <- "LOGS"

col.names <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
               "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types <- c("date", "numeric", "text", "text", 
               "numeric", "text", "numeric", "numeric", 
               "text", "text", "text", "text", 
               "text", "text", "text", "text",
               "text", "text")

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4) %>%
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, T0 = start.time) #%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max(data.shift$Shift))

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(data.all,
            file = files$all,
            quote = "none")

if (!file.exists(files$shift))
  write_csv(data.shift,
            file = files$shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(files$formatted))
  write_csv(formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")


```



## 2018

No offshore log exists for 2018
```{r}
Year <- 2018
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

sheet.name <- "LOGS"

col.names <- c("DATE",	"EVENT", 	"TIME",	"OBS#",
               "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types <- c("numeric", "date", "numeric", "text", "text", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text", "text",
                       "text", "text", "text", "text")

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, T0 = start.time) #%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max(data.shift$Shift))


files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(data.all,
            file = files$all,
            quote = "none")

if (!file.exists(files$shift))
  write_csv(data.shift,
            file = files$shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(files$formatted))
  write_csv(formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")


```





## 2019

No offshore log exists for 2019
```{r}
# Event for 4/29/2019 at 1845 was changed from "1" to "4". 2022-06-24
# Event for 5/9/2019 at 0830 was changed from "1" to "3". 2022-06-24
# Event for 5/23/2019 at 1200 was changed from "1" to "3". 2022-06-24

Year <- 2019
dir.name <- paste0("C_C ", Year)
start.time <- "700"

xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

sheet.name <- "INSHORE LOGS"

col.names <- c("DATE",	"EVENT", 	"TIME",	"OBS #",
               "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types <- c("date", "numeric", "numeric", "text", "text", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text", "text",
                       "text", "text", "text")

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, T0 = start.time) #%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max(data.shift$Shift))


files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(data.all,
            file = files$all,
            quote = "none")

if (!file.exists(files$shift))
  write_csv(data.shift,
            file = files$shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(files$formatted))
  write_csv(formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")


```


No data for 2020 - COVID.

## 2021

```{r}
# Event for 4/20/2021 at 745 was changed from "3" to "5". 2022-06-24
Year <- 2021
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

sheet.name <- "INSHORE LOGS"

col.names <- c("DATE",	"EVENT", 	"TIME",	"OBS #",
                       "VIS IN",	"SEA ST",	"C/C", "IN/OFF")

col.types <- c("date", "numeric", "numeric", "text", "text", 
                       "numeric", "text", "numeric", "numeric", 
                       "text", "text", "text", "text", 
                       "text", "text", "text", "text",
                       "text", "text", "text", "text", "text")

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, T0 = start.time) #%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max(data.shift$Shift))

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(data.all,
            file = files$all,
            quote = "none")

if (!file.exists(files$shift))
  write_csv(data.shift,
            file = files$shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(files$formatted))
  write_csv(formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```


## 2022


```{r}
# PROBLEM WITH AT LEAST ONE SHIFT 2022-03-28 ENDING/STARTING AT NOT EXACTLY AT THE 
# TOP OF THE HOUR (1558 INSTEAD OF 1600). THIS SHOULD BE EDITED IN THE DATA FILE. 
# CONTINUE HERE 2022-06-22  -> IT HAS BEEN EDITED TO 1600 2022-06-23

Year <- 2022
dir.name <- paste0("C_C ", Year)
start.time <- "700"
xls.files <- list.files(path = paste0(data.dir, dir.name), pattern = ".xls")
xls.file.name.inshore <- paste0(data.dir, dir.name, "/", xls.files[1])

sheet.name <- "MomCalf Logs 2022 postQC"
# c("Date", "Event", "Time", "Obs. Code", 
#  "Sea State", "Vis. IN", "Cow  / Calf")

# These are not the names of all columns. These are the names of columns in the
# spreadsheet that are needed. These names change among years, so they need to
# be specified for each year.
col.names <- c("DATE", 	"EVENT", 	"TIME",	"OBS #",
               "SEA ST", "VIS IN", "M/C", "LOCATION (IN/OFF)")

# these are column types of all columns in the spreadsheet. 
col.types <- c("date", "numeric", "numeric", "text", "text", 
               "numeric", "numeric", "numeric", "numeric", "text", 
               "text", "text", "text", "numeric", "text", 
               "text", "text", "text")

# get the data using get.data function, which is in Piedras_Blancas_fcns.R
data.all <- get.data(Year = Year,
                     xls.file.name = xls.file.name.inshore,
                     sheet.name = sheet.name,
                     col.types = col.types,
                     col.names = all_of(col.names),
                     start.time = start.time,
                     max.shift = 4)%>% 
  extract.all.vars()

# calculate effort and other statistics per 3-hr shift, using find.effort
# function in Piedras_Blancas_fcns.R
data.shift <- find.effort(data.all, T0 = start.time) #%>% extract.shift.vars()

formatted.all.data <- format.output(data.shift, max.shift = max(data.shift$Shift))

files <- file.names(out.dir, Year)

if (!file.exists(files$all))
  write_csv(data.all ,
            file = files$all,
            quote = "none")

if (!file.exists(files$shift))
  write_csv(data.shift,
            file = files$shift, 
            quote = "none")

# Need to remove NA to be used in Collating and Formatting v2.R
if (!file.exists(files$formatted))
  write_csv(formatted.all.data,
            file = files$formatted, 
            quote = "none",
            na = "")

```

